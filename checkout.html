<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Commande - Novaxell</title>
  <meta name="description" content="Dépannage, optimisation et vente de services à prix réduits, avec des astuces utiles pour vos appareils iOS et Android !">

  <!-- OpenGraph (Google, Facebook, Discord, WhatsApp) -->
  <meta property="og:title" content="Commande - Novaxell">
  <meta property="og:description" content="Dépannage, optimisation et vente de services à prix réduits, avec des astuces utiles pour vos appareils iOS et Android !">
  <meta property="og:image" content="https://novaxell.xyz/logo.png">
  <meta property="og:url" content="https://novaxell.xyz/checkout">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Commande - Novaxell">
  <meta name="twitter:description" content="Dépannage, optimisation et vente de services à prix réduits, avec des astuces utiles pour vos appareils iOS et Android !">
  <meta name="twitter:image" content="https://novaxell.xyz/logo.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://novaxell.xyz/logo.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AZpaA_mU_4vIhWma100cHGbhpKnJuIhdfpkb4Xq2JoHZosr3ealx9irdgVJUDkuwVpbut5JoxcEuZfKO&currency=EUR"></script>

  <style>
    :root {
      --primary: #f973ff;      /* magenta/rose principal */
      --primary-dark: #db38ff; /* variante plus sombre */
      --accent: #ec4899;
      --surface: #050509;      /* fond cartes très sombre */
      --surface-2: #080812;
      --muted: #9ca3af;
      --light: #e5e7eb;
      --success: #22c55e;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--light);
      /* Fond très sombre + légères lueurs, les vraies particules sont gérées par particles.js */
      background:
        radial-gradient(800px 500px at 10% -20%, rgba(88,28,135,0.25), transparent 60%),
        radial-gradient(900px 600px at 110% 120%, rgba(236,72,153,0.18), transparent 55%),
        #02010a;
    }

    /* Particles background */
    #particles-js { position: fixed; inset: 0; z-index: -1; }

    .header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(14px);
      background: rgba(2,6,23,.6);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .header-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 14px 16px;
      display: flex; align-items: center; justify-content: center; position: relative;
    }
    .logo { display: inline-flex; gap: 10px; align-items: center; text-decoration: none; }
    .logo i { color: var(--primary); }
    .logo span {
      font-weight: 800; letter-spacing: .4px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .back-btn { 
      position: absolute; 
      left: 20px; 
      top: 20px; 
      width: 44px; 
      height: 44px; 
      border-radius: 12px; 
      border: 1px solid rgba(148,163,184,0.2); 
      background: rgba(15,23,42,0.8); 
      backdrop-filter: blur(10px);
      color: #e5e7eb; 
      cursor:pointer; 
      display:inline-flex; 
      align-items:center; 
      justify-content:center;
      transition: all 0.2s ease;
      z-index: 10;
    }
    .back-btn:hover { 
      background: rgba(37,99,235,0.2); 
      border-color: rgba(37,99,235,0.4);
      transform: translateX(-2px);
    }
    .back-btn i {
      font-size: 1rem;
    }

    .page {
      width: 100%;
      margin: 0;
      padding: 16px 16px 24px;
      display:grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 18px;
      align-items: stretch;
      min-height: calc(100vh - 64px);
    }
    @media (max-width: 1024px) {
      .page {
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 12px 10px 20px;
        min-height: auto;
      }
    }

    /* Left: order summary */
    .summary {
      background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
      border: 1px solid rgba(31,41,55,0.95);
      border-radius: 18px;
      overflow: hidden;
      display:flex;
      flex-direction:column;
      position: relative;
      box-shadow: 0 18px 40px rgba(0,0,0,.65);
      backdrop-filter: blur(16px);
      height: auto;
      min-height: 420px;
    }
    .summary-header { padding: 14px 20px 10px; border-bottom: 1px solid rgba(255,255,255,.06); display:flex; align-items:center; gap:10px; font-size: 0.9rem; }
    .summary-header i { color: var(--primary); }
    .summary-body {
      padding: 14px 18px 16px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      overflow: auto;
      flex:1 1 auto;
    }
    .summary-topline {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: rgba(15,23,42,0.6);
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .summary-topline span:first-child {
      font-size: 0.9rem;
      color: #9ca3af;
      font-weight: 500;
    }
    .summary-topline span.badge {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.3);
      font-size: 0.8rem;
      color: #e5e7eb;
      background: rgba(37,99,235,0.1);
    }

    .items { 
      flex:1 1 auto; 
      display:flex; 
      flex-direction:column; 
      gap:10px; 
      margin: 8px 0 0 0;
    }
    .item-row { 
      display:grid; 
      grid-template-columns:auto 1fr auto; 
      gap:14px; 
      align-items:center; 
      background: rgba(15,23,42,0.3); 
      border:1px solid rgba(148,163,184,0.1); 
      border-radius:12px; 
      padding:14px 16px; 
      transition: all 0.2s ease;
    }
    .item-row:hover {
      background: rgba(15,23,42,0.5);
      border-color: rgba(148,163,184,0.2);
    }
    .item-row img { 
      width: 48px; 
      height: 48px; 
      border-radius: 10px; 
      object-fit: cover; 
      display: block; 
    }
    .item-title { 
      font-weight: 600; 
      font-size: 0.95rem; 
      color: #e5e7eb;
    }
    .item-sub { 
      color: #9ca3af; 
      font-size: 0.85rem; 
      margin-top: 2px;
    }
    .item-price { 
      font-weight: 700; 
      font-size: 1rem; 
      color: #ffffff;
    }

    .summary-totals { 
      padding: 16px; 
      background: rgba(15,23,42,0.4); 
      border-radius: 12px; 
      margin: 0 0 8px 0; 
      display:grid; 
      gap:8px; 
      font-size: .9rem; 
    }
    .summary-totals .row { 
      display:flex; 
      align-items:center; 
      justify-content: space-between; 
      padding: 4px 0;
    }
    .summary-totals .row.total { 
      font-size: 1.2rem; 
      font-weight: 800; 
      color: #ffffff; 
      border-top: 1px solid rgba(148,163,184,0.2); 
      padding-top: 12px;
      margin-top: 4px;
    }
    .summary-footer {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid rgba(15,23,42,.85);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:.8rem;
      color: var(--muted);
    }
    .summary-footer a { color: var(--muted); text-decoration:none; }
    .summary-footer a:hover { text-decoration:underline; }
    .summary-footer-icons { display:flex; align-items:center; gap:10px; font-size:0.95rem; }

    /* Right: checkout steps */
    .panel {
      background: radial-gradient(circle at top right, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
      border: 1px solid rgba(31,41,55,0.95);
      border-radius: 18px;
      overflow: hidden;
      display:flex;
      flex-direction:column;
      position: relative;
      box-shadow: 0 18px 40px rgba(0,0,0,.65);
      backdrop-filter: blur(16px);
      height: auto;
      min-height: 420px;
    }
    .steps {
      display:flex;
      gap:32px;
      padding:16px 24px 12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      font-size: .9rem;
    }
    .step {
      font-weight:650;
      opacity:.45;
      position:relative;
      padding-bottom:6px;
      cursor: default;
      text-transform: uppercase;
      letter-spacing: .08em;
      font-size: .78rem;
    }
    .step.active { opacity:1; }
    .step.active::after {
      content:'';
      position:absolute;
      left:0;
      right:0;
      bottom:-3px;
      height:3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius:999px;
    }

    .panel-body { padding: 18px 24px 20px; display:grid; gap:18px; overflow:auto; }
    .field { display:grid; gap:8px; }
    .label { font-weight: 600; font-size: .9rem; letter-spacing:.02em; text-transform:none; }
    .label small { display:block; font-weight:400; font-size:.8rem; color:rgba(148,163,184,0.9); margin-top:2px; }
    .input, .select {
      background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
      border: 1px solid rgba(31,41,55,.95);
      color: var(--light);
      border-radius: 12px; padding: 12px 14px; font-size: 0.95rem;
      outline: none;
      box-shadow: 0 0 0 1px rgba(15,23,42,1);
      transition: border-color .16s ease-out, box-shadow .16s ease-out, background .16s ease-out;
    }
    .input::placeholder { color: rgba(148,163,184,0.8); }
    .input:focus, .select:focus {
      border-color: rgba(129,140,248,0.9);
      box-shadow: 0 0 0 1px rgba(129,140,248,0.9), 0 0 22px rgba(79,70,229,0.45);
    }
    .two-col { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 520px) { .two-col { grid-template-columns: 1fr; } }

    .paymethods { display:grid; gap:10px; margin-top: 2px; }
    .method {
      position: relative;
      background:
        radial-gradient(circle at top left, rgba(79,70,229,0.35), transparent 60%),
        rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,184,0.25);
      border-radius: 14px;
      padding: 11px 14px;
      display:flex; align-items:center; justify-content:space-between; cursor:pointer;
      font-size: .95rem;
      overflow: hidden;
      transition: border-color .18s ease-out, box-shadow .18s ease-out, transform .12s ease-out, background .18s ease-out;
    }
    .method span { display:flex; align-items:center; gap:10px; }
    .method i {
      width: 26px; height: 26px;
      border-radius: 999px;
      display:inline-flex; align-items:center; justify-content:center;
      background: rgba(15,23,42,0.9);
      box-shadow: 0 0 0 1px rgba(148,163,184,0.35);
      font-size: 0.9rem;
    }
    .method:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 36px rgba(15,23,42,0.9);
      border-color: rgba(129,140,248,0.8);
    }
    .method::after {
      content:'';
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:0;
      background: radial-gradient(circle at right center, rgba(236,72,153,0.45), transparent 55%);
      transition: opacity .18s ease-out;
    }
    .method.active {
      border-color: rgba(249,115,255,0.95);
      box-shadow: 0 0 0 1px rgba(249,115,255,0.7), 0 0 32px rgba(249,115,255,0.28);
    }
    .method.active::after { opacity: 1; }
    .method .badge {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      background: rgba(236,72,153,0.16);
      border: 1px solid rgba(236,72,153,0.6);
      color: #f9a8d4;
    }
    .method[data-id="paypal"] i,
    .method[data-id="paypal-ff"] i {
      color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.7);
    }
    .method[data-id="btc"] i { color: #f59e0b; box-shadow: 0 0 0 1px rgba(245,158,11,0.6); }
    .method[data-id="ltc"] i { color: #e5e7eb; box-shadow: 0 0 0 1px rgba(148,163,184,0.7); }
    
    .field-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .field-subtitle {
      font-size: 0.8rem;
      color: #9ca3af;
      opacity: 0.8;
    }
    .input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
    }
    .input-icon {
      position: absolute;
      left: 14px;
      color: #6b7280;
      font-size: 0.9rem;
      z-index: 1;
    }
    .input-wrapper .input {
      padding-left: 42px;
      padding: 14px 16px 14px 42px;
      min-height: 48px;
      width: 100%;
      box-sizing: border-box;
    }
    
    .agree { display:flex; gap:10px; align-items:flex-start; font-size:.9rem; color: var(--muted); margin-top: 12px; }

    .cta {
      background: linear-gradient(135deg, #ec4899, #f973ff);
      border: none; color: white; font-weight: 700; letter-spacing:.1px;
      border-radius: 999px; padding: 12px 16px; cursor: pointer; width: 100%;
      box-shadow: 0 18px 40px rgba(236,72,153,.55);
      font-size: 1rem;
    }
    .cta:disabled { opacity: .6; cursor: not-allowed; }

    .footer-note { text-align:center; color: var(--muted); font-size:.85rem; padding: 16px; }

    .chip { background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); border-radius:999px; padding:6px 10px; font-size:.8rem; color:var(--light); }

    .currency-row { display:flex; align-items:center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
    .currency-pill {
      position: relative;
      display:inline-flex;
      align-items:center;
      justify-content: space-between;
      gap:8px;
      padding:6px 12px;
      border-radius:999px;
      background: radial-gradient(circle at top left, rgba(79,70,229,0.45), transparent 60%), rgba(15,23,42,0.98);
      border:1px solid rgba(129,140,248,0.7);
      font-size:.85rem;
      color: var(--light);
      cursor: pointer;
      min-width: 150px;
    }
    .currency-current {
      display:flex;
      align-items:center;
      gap:6px;
      white-space: nowrap;
    }
    .currency-pill i { font-size:.7rem; opacity:.9; }
    .currency-menu {
      position:absolute;
      left:0;
      right:0;
      top: calc(100% + 6px);
      background: rgba(15,23,42,0.98);
      border-radius: 14px;
      border:1px solid rgba(31,41,55,0.95);
      box-shadow: 0 18px 40px rgba(0,0,0,.8);
      padding:6px;
      display:none;
      z-index: 20;
    }
    .currency-menu.open { display:block; }
    .currency-menu button {
      width:100%;
      border:none;
      background: transparent;
      color: var(--light);
      text-align:left;
      padding:7px 8px;
      border-radius:10px;
      font-size:.85rem;
      cursor:pointer;
    }
    .currency-menu button:hover {
      background: rgba(79,70,229,0.25);
    }

    /* Lignes de séparation centrales sans effet de carte/modale */

    /* Bottom fade inside panels */
    .summary::after, .panel::after { display:none; }
    .panel-body, .summary-body { z-index: 1; }

    .checkout-footer-global { text-align:center; color: var(--muted); font-size:.85rem; padding: 10px 16px 18px; }

    footer {
      background: rgba(2, 6, 23, 0.85);
      border-top: 1px solid rgba(148, 163, 184, 0.25);
      padding: 16px 12px;
      text-align: center;
      color: var(--muted);
      font-size: 0.85rem;
    }

    /* Modale plein écran après commande */
    .checkout-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(15,23,42,0.94), rgba(2,6,23,0.98));
      backdrop-filter: blur(22px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 80;
      padding: 1.5rem;
    }
    .checkout-overlay.active { display:flex; }

    .checkout-modal {
      max-width: 540px;
      width: 100%;
      background: rgba(15,23,42,0.98);
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow: 0 30px 80px rgba(0,0,0,0.85);
      padding: 1.6rem 1.8rem 1.5rem;
      text-align: center;
    }

    .checkout-modal h2 {
      font-size: 1.4rem;
      margin-bottom: 0.6rem;
    }

    .checkout-modal p {
      font-size: 0.95rem;
      color: var(--muted);
      margin-bottom: 1.3rem;
    }

    .checkout-modal .discord-main-btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:0.6rem;
      padding: 12px 22px;
      border-radius: 999px;
      border:none;
      cursor:pointer;
      background: linear-gradient(135deg,#5865F2,#4752C4);
      color:white;
      font-weight:600;
      font-size:0.95rem;
      box-shadow:0 18px 40px rgba(88,101,242,0.55);
      text-decoration:none;
    }

    .checkout-modal .discord-main-btn i { font-size:1rem; }

    .checkout-modal small {
      display:block;
      margin-top:0.7rem;
      font-size:0.8rem;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <button class="back-btn" onclick="window.history.back()" aria-label="Retour"><i class="fas fa-arrow-left"></i></button>
      <a class="logo" href="shop.html"><i class="fas fa-bolt"></i><span>Novaxell</span></a>
    </div>
  </header>

  <div id="particles-js"></div>

  <main class="page">
    <!-- LEFT: SUMMARY -->
    <aside class="summary" id="summary">
      <div class="summary-header">
        <i class="fas fa-receipt"></i>
        <strong>Détails de la commande</strong>
      </div>
      <div class="summary-body">
        <div class="summary-topline">
          <span>Récapitulatif de votre commande</span>
          <span class="badge" id="summaryCount">Panier vide</span>
        </div>
        <div id="summaryItems" class="items"></div>
        <div class="summary-totals">
          <div class="row"><span>Sous-total</span><span id="subtotal">0,00 €</span></div>
          <div class="row"><span>Frais</span><span id="fees">0,00 €</span></div>
          <div class="row total"><span>Total</span><span id="total">0,00 €</span></div>
        </div>
        <div class="summary-footer">
          <div>
            <a href="terms.html">Terms of Service</a>
          </div>
          <div class="summary-footer-icons">
            <a href="https://discord.gg/novaxell" target="_blank" rel="noopener" aria-label="Discord Novaxell"><i class="fab fa-discord"></i></a>
            <a href="mailto:contact@novaxell.xyz" aria-label="Contact mail"><i class="fas fa-paper-plane"></i></a>
          </div>
        </div>
      </div>
    </aside>

    <!-- RIGHT: FORM -->
    <section class="panel">
      <div class="steps">
        <div class="step active" id="step1">Étape 1 · Informations</div>
        <div class="step" id="step2">Étape 2 · Paiement</div>
        <div class="step" id="step3">Étape 3 · Réception</div>
      </div>
      <div class="panel-body">
        <div class="field" id="discordField">
          <div class="field-header">
            <label class="label">Nom d'utilisateur Discord</label>
            <span class="field-subtitle"></span>
          </div>
          <div class="input-wrapper">
            <i class="fab fa-discord input-icon"></i>
            <input id="discordTag" type="text" class="input" placeholder="ne donne pas ton nom d'affichage" />
          </div>
        </div>

        <div class="field" id="emailField" style="display:none;">
          <div class="field-header">
            <label class="label">Adresse Email</label>
            <span class="field-subtitle"></span>
          </div>
          <div class="input-wrapper">
            <i class="fas fa-envelope input-icon"></i>
            <input id="emailInput" type="email" class="input" placeholder="La confirmation de la commande sera envoyée à cet email." />
          </div>
        </div>

        <div class="field">
          <label class="label">Code promo</label>
          <div class="two-col">
            <input type="text" class="input" placeholder="Tu as un code promo ? Écris-le ici." />
            <button type="button" class="cta" style="max-width:180px;padding:10px 14px;font-size:0.9rem;box-shadow:none;white-space:nowrap;">Appliquer</button>
          </div>
        </div>

        <div class="field" style="margin-top: -4px;">
          <div class="currency-row" style="display: flex; justify-content: flex-end; align-items: center;">
            <div class="currency-pill" id="currencyDropdown" data-value="EUR" style="margin-left: auto;">
              <span class="currency-current" id="currencyCurrent">
                <strong>EUR (€)</strong>
              </span>
              <i class="fas fa-chevron-down"></i>
              <div class="currency-menu" id="currencyMenu">
                <button type="button" data-value="EUR">EUR (€)</button>
                <button type="button" data-value="USD">USD ($)</button>
                <button type="button" data-value="GBP">GBP (£)</button>
                <button type="button" data-value="CHF">CHF (Fr)</button>
                <button type="button" data-value="CAD">CAD ($)</button>
              </div>
            </div>
          </div>
        </div>

        <div class="field">
          <label class="label">Méthode de paiement</label>
          <div class="paymethods" id="methods">
            <div data-id="paypal" class="method"><span><i class="fab fa-paypal"></i> &nbsp; PayPal (biens &amp; services)</span><span class="badge">Recommandé</span></div>
            <div data-id="paypal-ff" class="method"><span><i class="fab fa-paypal"></i> &nbsp; PayPal (entre proches · sans frais)</span></div>
            <div data-id="btc" class="method"><span><i class="fab fa-bitcoin"></i> &nbsp; Bitcoin (BTC)</span></div>
            <div data-id="ltc" class="method"><span><i class="fas fa-coins"></i> &nbsp; Litecoin (LTC)</span></div>
          </div>
        </div>

        <label class="agree">
          <input id="agree" type="checkbox" />
          <span>
            J'ai lu et j'accepte
            <a href="terms.html" style="color:#9ca3af;text-decoration:underline;">termes et Conditions d'utilisation Novaxell</a>.
          </span>
        </label>

        <button id="proceed" class="cta" disabled>Procéder au paiement</button>
        <div id="step2PayPal" style="display:none;margin-top:18px;padding:14px 14px 12px;border-radius:16px;background:rgba(15,23,42,0.98);border:1px solid rgba(148,163,184,0.4);box-shadow:0 18px 40px rgba(0,0,0,0.7);">
          <h3 style="margin:0 0 8px 0;font-size:1rem;">Étape 2 · Payer avec PayPal</h3>
          <p style="text-align:left;font-size:0.9rem;line-height:1.5;margin:0 0 0.8rem 0;color:#9ca3af;">
            Clique sur le bouton ci-dessous pour régler ta commande via <strong>PayPal biens &amp; services</strong>.
          </p>
          <div id="paypal-button-container"></div>
        </div>

        <div id="step2PayPalFF" style="display:none;margin-top:18px;padding:14px 14px 12px;border-radius:16px;background:rgba(15,23,42,0.98);border:1px solid rgba(148,163,184,0.4);box-shadow:0 18px 40px rgba(0,0,0,0.7);">
          <h3 style="margin:0 0 8px 0;font-size:1rem;">Étape 2 · PayPal entre proches (sans frais)</h3>
          <p style="text-align:left;font-size:0.9rem;line-height:1.5;margin:0 0 0.8rem 0;color:#9ca3af;">
            Envoie le paiement en <strong>entre proches / Friends &amp; Family</strong> à l'adresse ci-dessous, puis rejoins le serveur Discord pour recevoir ta commande.
          </p>
          <div style="display:grid;gap:8px;margin-top:4px;">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
              <div class="chip" style="flex:1 1 auto;">Email PayPal : <strong id="ffEmail">even33298@gmail.com</strong></div>
              <button type="button" id="copyFFEmail" class="discord-main-btn" style="padding:6px 14px;font-size:0.8rem;box-shadow:none;">Copier</button>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
              <div class="chip" style="flex:1 1 auto;">Montant total : <strong id="ffAmount">—</strong></div>
              <button type="button" id="copyFFAmount" class="discord-main-btn" style="padding:6px 14px;font-size:0.8rem;box-shadow:none;">Copier</button>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
              <div class="chip" style="flex:1 1 auto;">Note / Message : <code id="ffNote">Commande Novaxell</code></div>
              <button type="button" id="copyFFNote" class="discord-main-btn" style="padding:6px 14px;font-size:0.8rem;box-shadow:none;">Copier</button>
            </div>
          </div>
        </div>

        <div id="step2Crypto" style="display:none;margin-top:18px;padding:14px 14px 12px;border-radius:16px;background:rgba(15,23,42,0.98);border:1px solid rgba(148,163,184,0.4);box-shadow:0 18px 40px rgba(0,0,0,0.7);">
          <h3 style="margin:0 0 8px 0;font-size:1rem;">Étape 2 · Envoyer la crypto</h3>
          <p style="text-align:left;font-size:0.9rem;line-height:1.5;margin:0 0 0.8rem 0;color:#9ca3af;" id="cryptoInstructions">
            Envoie le montant indiqué à l'adresse ci-dessous, puis rejoins le serveur Discord pour valider ta commande.
          </p>
          <div style="display:grid;gap:8px;margin-top:4px;">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
              <div class="chip" style="flex:1 1 auto;">Réseau : <strong id="cryptoNetwork">—</strong></div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
              <div class="chip" style="flex:1 1 auto;">Adresse : <code id="cryptoAddress">—</code></div>
              <button type="button" id="copyCryptoAddress" class="discord-main-btn" style="padding:6px 14px;font-size:0.8rem;box-shadow:none;">Copier</button>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
              <div class="chip" style="flex:1 1 auto;">Montant total (affiché) : <strong id="cryptoAmount">—</strong></div>
              <button type="button" id="copyCryptoAmount" class="discord-main-btn" style="padding:6px 14px;font-size:0.8rem;box-shadow:none;">Copier</button>
            </div>
          </div>
        </div>

        <div id="discordFollowup" style="display:none;margin-top:14px;text-align:center;">
          <a href="https://discord.gg/novaxell" target="_blank" rel="noopener" style="display:inline-flex;align-items:center;gap:8px;padding:10px 18px;border-radius:999px;border:1px solid rgba(148,163,184,0.5);background:rgba(15,23,42,0.92);color:#e5e7eb;text-decoration:none;font-size:0.9rem;">
            <i class="fab fa-discord" style="color:#5865f2;"></i>
            <span>Rejoignez le serveur Discord pour finaliser l'achat</span>
          </a>
        </div>
      </div>
    </section>
  </main>

  <!-- Modale Discord après la commande -->
  <div class="checkout-overlay" id="checkoutOverlay">
    <div class="checkout-modal">
      <h2>Merci pour votre commande</h2>
      <p>
        Pour finaliser le paiement et recevoir vos comptes, rejoignez notre serveur Discord.
        Un ticket sera automatiquement ouvert par le staff dès votre arrivée.
      </p>
      <a href="https://discord.gg/novaxell" target="_blank" rel="noopener" class="discord-main-btn">
        <i class="fab fa-discord"></i>
        <span>Rejoindre le serveur Discord</span>
      </a>
      <small>Si vous êtes déjà sur le serveur, ouvrez un ticket en mentionnant votre pseudo Discord et votre commande.</small>
    </div>
  </div>

  <script>
    // Webhook Discord Novaxell (pour les commandes)
    const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1442349621568344064/IF5zExOI4PGYvt_F31QWmHBjJuiHxT8c7R8M4EvEk-vcFYjsaqzeI0AnqGfOhrPVNmko';
    // API du bot (local par défaut). Si ton bot est ailleurs, remplace par son URL publique.
    const BOT_ORDER_API_URL = 'http://localhost:5056/order';
    // Adresses crypto
    const BTC_ADDRESS = 'bc1qutdckvhmjhyry23crp3mv825tn2tntkazutc8w';
    const LTC_ADDRESS = 'ltc1qfl04yy24uqxsvn96qvxum3up68rjrnr3vq75f7';
    // Particles.js avec lignes reliées
    particlesJS('particles-js', {
      particles: {
        number: { value: 70, density: { enable: true, value_area: 900 } },
        color: { value: ['#94a3b8','#60a5fa','#a78bfa'] },
        shape: { type: 'circle' },
        opacity: { value: 0.45 },
        size: { value: 2.5, random: true },
        line_linked: { enable: true, distance: 140, color: '#48566a', opacity: 0.35, width: 1 },
        move: { enable: true, speed: 1.1, out_mode: 'out' }
      },
      interactivity: {
        detect_on: 'canvas',
        events: { onhover: { enable: true, mode: 'grab' }, onclick: { enable: false }, resize: true },
        modes: { grab: { distance: 160, line_linked: { opacity: 0.5 } } }
      },
      retina_detect: true
    });


    const cart = (function(){
      try { return JSON.parse(localStorage.getItem('novaxell_cart')||'[]') } catch(e){ return [] }
    })();

    const summaryItems = document.getElementById('summaryItems');
    const summaryCountEl = document.getElementById('summaryCount');
    const subtotalEl = document.getElementById('subtotal');
    const feesEl = document.getElementById('fees');
    const totalEl = document.getElementById('total');
    const summaryBigTotalEl = document.getElementById('summaryBigTotal');

    // gestion des devises
    const currencyDropdown = document.getElementById('currencyDropdown');
    const currencyRates = {
      EUR: 1,
      USD: 1.15,  // ≈ 1€ = 1.15$
      GBP: 0.87,
      CHF: 0.97,
      CAD: 1.48
    };
    const currencySymbols = {
      EUR: '€',
      USD: '$',
      GBP: '£',
      CHF: 'Fr',
      CAD: '$'
    };

    let baseSubtotalEUR = 0;
    let baseFeesEUR = 0;

    function parsePrice(str){
      return parseFloat(String(str||'0').replace('€','').replace(/\s/g,'').replace(',','.'))||0;
    }

    function formatPriceAmount(amount, currency){
      const sym = currencySymbols[currency] || '€';
      // arrondi toujours au centime supérieur
      const rounded = Math.ceil(amount * 100) / 100;
      return rounded.toFixed(2).replace('.',',') + ' ' + sym;
    }

    function getCurrentCurrency(){
      return (currencyDropdown && currencyDropdown.dataset.value) || 'EUR';
    }

    function renderSummary(){
      summaryItems.innerHTML = '';
      let subtotal = 0;
      let count = 0;
      cart.forEach(entry => {
        const price = parsePrice(entry.service.price);
        const qty = entry.quantity||1;
        subtotal += price*qty;
        count += qty;
        const row = document.createElement('div');
        row.className = 'item-row';
        row.innerHTML = `
          <img src="${entry.service.img}" alt="${entry.service.name}">
          <div>
            <div class="item-title">${entry.service.name}</div>
            <div class="item-sub">${entry.service.desc||''} · <strong>x${qty}</strong></div>
          </div>
          <div class="item-price" data-base-eur="${price*qty}"></div>
        `;
        summaryItems.appendChild(row);
      });
      const fees = 0; // Frais éventuels (0 par défaut)
      baseSubtotalEUR = subtotal;
      baseFeesEUR = fees;
      if (summaryCountEl) {
        summaryCountEl.textContent = count > 0 ? `${count} article${count>1?'s':''}` : 'Panier vide';
      }
      applyCurrency();
    }

    renderSummary();

    // applique la devise sélectionnée sur les montants
    function applyCurrency(){
      const cur = getCurrentCurrency();
      const rate = currencyRates[cur] || 1;

      // lignes
      document.querySelectorAll('.item-price[data-base-eur]').forEach(el => {
        const base = parseFloat(el.getAttribute('data-base-eur')||'0') || 0;
        el.textContent = formatPriceAmount(base*rate, cur);
      });

      subtotalEl.textContent = formatPriceAmount(baseSubtotalEUR*rate, cur);
      feesEl.textContent = formatPriceAmount(baseFeesEUR*rate, cur);
      const totalText = formatPriceAmount((baseSubtotalEUR+baseFeesEUR)*rate, cur);
      totalEl.textContent = totalText;
      if (summaryBigTotalEl) summaryBigTotalEl.textContent = totalText;
    }

    // (Coupon désactivé sur cette version : le total correspond toujours au panier)

    function setStep(step){
      const s1 = document.getElementById('step1');
      const s2 = document.getElementById('step2');
      const s3 = document.getElementById('step3');
      if (!s1 || !s2 || !s3) return;
      [s1,s2,s3].forEach(el => el.classList.remove('active'));
      if (step === 1) s1.classList.add('active');
      else if (step === 2) s2.classList.add('active');
      else if (step === 3) s3.classList.add('active');
    }

    // Dropdown custom pour la devise
    (function(){
      const dropdown = document.getElementById('currencyDropdown');
      const menu = document.getElementById('currencyMenu');
      const current = document.getElementById('currencyCurrent');
      if (!dropdown || !menu || !current) return;

      function setCurrency(value, label) {
        dropdown.dataset.value = value;
        current.querySelector('strong').textContent = label;
        applyCurrency();
      }

      dropdown.addEventListener('click', function(e) {
        // si on clique sur un bouton d'option, laisser l'autre handler gérer
        if (e.target.closest('button[data-value]')) return;
        menu.classList.toggle('open');
      });

      menu.querySelectorAll('button[data-value]').forEach(btn => {
        btn.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          const label = this.textContent.trim();
          setCurrency(value, label);
          menu.classList.remove('open');
        });
      });

      document.addEventListener('click', function(e) {
        if (!dropdown.contains(e.target)) {
          menu.classList.remove('open');
        }
      });
    })();

    // Méthodes de paiement (sélection)
    document.querySelectorAll('.method').forEach(m => {
      m.addEventListener('click', () => {
        document.querySelectorAll('.method').forEach(x => x.classList.remove('active'));
        m.classList.add('active');
        
        // Changer l'affichage selon la méthode de paiement
        const methodId = m.getAttribute('data-id');
        const discordField = document.getElementById('discordField');
        const emailField = document.getElementById('emailField');
        
        if (methodId === 'paypal-ff') {
          // PayPal F&F : demander le nom d'utilisateur Discord
          discordField.style.display = 'block';
          emailField.style.display = 'none';
        } else {
          // Autres méthodes : demander l'email
          discordField.style.display = 'none';
          emailField.style.display = 'block';
        }
        
        validate();
        setStep(1);
        const step2PayPal = document.getElementById('step2PayPal');
        const step2PayPalFF = document.getElementById('step2PayPalFF');
        const step2Crypto = document.getElementById('step2Crypto');
        if (step2PayPal) step2PayPal.style.display = 'none';
        if (step2PayPalFF) step2PayPalFF.style.display = 'none';
        if (step2Crypto) step2Crypto.style.display = 'none';
      });
    });

    // Enable proceed when pseudo Discord/email + agree + panier + moyen de paiement sélectionné
    function validate(){
      const methodEl = document.querySelector('.method.active');
      const methodId = methodEl ? methodEl.getAttribute('data-id') : '';
      
      let contactField = '';
      if (methodId === 'paypal-ff') {
        contactField = document.getElementById('discordTag').value.trim();
      } else {
        contactField = document.getElementById('emailInput').value.trim();
      }
      
      const agree = document.getElementById('agree').checked;
      const hasMethod = !!methodEl;
      const ok = contactField.length >= 2 && agree && cart.length>0 && hasMethod;
      document.getElementById('proceed').disabled = !ok;
    }
    document.getElementById('discordTag').addEventListener('input', validate);
    document.getElementById('emailInput').addEventListener('input', validate);
    document.getElementById('agree').addEventListener('change', validate);
    validate();

    // Envoi de la commande directement au bot (API locale)
    async function sendOrderToBot() {
      try {
        if (!BOT_ORDER_API_URL) return false;
        const discordTag = document.getElementById('discordTag').value.trim();
        const methodEl = document.querySelector('.method.active');
        const methodId = methodEl ? methodEl.getAttribute('data-id') : 'inconnu';
        const methodLabel = methodEl ? methodEl.innerText.trim() : 'Méthode inconnue';
        const currency = getCurrentCurrency();
        const totalText = totalEl.textContent || '';
        const items = cart.map(entry => ({
          name: entry?.service?.name || 'Service',
          qty: entry?.quantity || 1,
          price: entry?.service?.price || ''
        }));

        const res = await fetch(BOT_ORDER_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            discordTag,
            payment: `${methodLabel} (id=${methodId})`,
            currency,
            total: totalText,
            items
          })
        });
        if (!res.ok) return false;
        const data = await res.json().catch(() => ({}));
        return !!data.ok;
      } catch (e) {
        console.warn('API bot non joignable:', e);
        return false;
      }
    }

    // Envoi de la commande vers Discord (fallback via webhook)
    async function sendOrderToDiscord() {
      if (!DISCORD_WEBHOOK_URL) {
        console.warn('Webhook Discord non configuré.');
        return false;
      }

      const discordTag = document.getElementById('discordTag').value.trim();
      const methodEl = document.querySelector('.method.active');
      const methodId = methodEl ? methodEl.getAttribute('data-id') : 'inconnu';
      const methodLabel = methodEl ? methodEl.innerText.trim() : 'Méthode inconnue';
      const currency = getCurrentCurrency();
      const totalText = totalEl.textContent || '';

      const lines = cart.map(entry => {
        const qty = entry.quantity || 1;
        const name = entry.service?.name || 'Service';
        const price = entry.service?.price || '';
        return `- ${qty}x ${name} (${price})`;
      });

      const content = [
        '**Nouvelle commande Novaxell**',
        `Client Discord: ${discordTag}`,
        `Moyen de paiement: ${methodLabel} (id=${methodId})`,
        `Devise: ${currency}`,
        `Total affiché: ${totalText}`,
        '',
        '**Détails panier :**',
        lines.join('\n') || 'Aucun article',
        '',
        'Créer un ticket pour ce client ?'
      ].join('\n');

      try {
        const res = await fetch(DISCORD_WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content })
        });
        return res.ok;
      } catch (e) {
        console.error('Erreur envoi webhook Discord:', e);
        return false;
      }
    }

    // Proceed: selon la méthode
    document.getElementById('proceed').addEventListener('click', async () => {
      const btn = document.getElementById('proceed');
      const overlay = document.getElementById('checkoutOverlay');
      btn.disabled = true;
      const originalText = btn.textContent;
      btn.textContent = 'Envoi de votre commande...';

      const methodEl = document.querySelector('.method.active');
      const methodId = methodEl ? methodEl.getAttribute('data-id') : 'inconnu';

      // Helper pour total numérique (point) et affichage formaté existant
      const cur = getCurrentCurrency();
      const rate = currencyRates[cur] || 1;
      const gross = Math.ceil((baseSubtotalEUR+baseFeesEUR)*rate*100)/100;
      const grossStr = gross.toFixed(2); // pour IPN (mc_gross)

      if (methodId === 'paypal') {
        const step2PayPal = document.getElementById('step2PayPal');
        const step2PayPalFF = document.getElementById('step2PayPalFF');
        const step2Crypto = document.getElementById('step2Crypto');
        if (step2Crypto) step2Crypto.style.display = 'none';
        if (step2PayPalFF) step2PayPalFF.style.display = 'none';
        if (step2PayPal) step2PayPal.style.display = 'block';
        setStep(2);

        // Rendre le bouton PayPal Checkout
        if (typeof paypal !== 'undefined') {
          document.getElementById('paypal-button-container').innerHTML = '';
          paypal.Buttons({
            createOrder: function(data, actions) {
              return fetch('/create-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ amount: grossStr, currency: cur })
              })
              .then(res => res.json())
              .then(data => data.id);
            },
            onApprove: function(data, actions) {
              return fetch('/capture-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ orderID: data.orderID })
              })
              .then(res => res.json())
              .then(async details => {
                try {
                  await sendOrderToBot();
                } catch(e) {}
                try {
                  await sendOrderToDiscord();
                } catch(e) {}
                setStep(3);
                const follow = document.getElementById('discordFollowup');
                if (follow) follow.style.display = 'block';
                if (overlay) overlay.classList.add('active');
              });
            },
            onError: function(err) {
              console.error(err);
              alert('Erreur lors du paiement PayPal');
            }
          }).render('#paypal-button-container');
        }

        btn.textContent = originalText;
        btn.disabled = false;
        return;
      }

      if (methodId === 'paypal-ff') {
        const step2PayPal = document.getElementById('step2PayPal');
        const step2PayPalFF = document.getElementById('step2PayPalFF');
        const step2Crypto = document.getElementById('step2Crypto');
        if (step2PayPal) step2PayPal.style.display = 'none';
        if (step2Crypto) step2Crypto.style.display = 'none';
        if (step2PayPalFF) step2PayPalFF.style.display = 'block';
        setStep(2);

        const ffAmountEl = document.getElementById('ffAmount');
        const ffNoteEl = document.getElementById('ffNote');
        if (ffAmountEl) ffAmountEl.textContent = totalEl.textContent;
        if (ffNoteEl) ffNoteEl.textContent = 'Commande ' + (document.getElementById('discordTag').value.trim() || 'Novaxell');

        const copyEmailBtn = document.getElementById('copyFFEmail');
        const copyAmountBtn = document.getElementById('copyFFAmount');
        const copyNoteBtn = document.getElementById('copyFFNote');
        if (copyEmailBtn) {
          copyEmailBtn.onclick = async () => {
            try { await navigator.clipboard.writeText(document.getElementById('ffEmail').textContent.trim()); } catch(e) {}
          };
        }
        if (copyAmountBtn) {
          copyAmountBtn.onclick = async () => {
            try { await navigator.clipboard.writeText(ffAmountEl.textContent.trim()); } catch(e) {}
          };
        }
        if (copyNoteBtn) {
          copyNoteBtn.onclick = async () => {
            try { await navigator.clipboard.writeText(ffNoteEl.textContent.trim()); } catch(e) {}
          };
        }

        try {
          await sendOrderToBot();
        } catch(e) {}
        try {
          await sendOrderToDiscord();
        } catch(e) {}

        const follow = document.getElementById('discordFollowup');
        if (follow) follow.style.display = 'block';

        btn.textContent = originalText;
        btn.disabled = false;
        return;
      }

      if (methodId === 'btc' || methodId === 'ltc') {
        const step2PayPal = document.getElementById('step2PayPal');
        const step2Crypto = document.getElementById('step2Crypto');
        if (step2PayPal) step2PayPal.style.display = 'none';
        if (step2Crypto) step2Crypto.style.display = 'block';
        setStep(2);

        const networkEl = document.getElementById('cryptoNetwork');
        const addrEl = document.getElementById('cryptoAddress');
        const amountEl = document.getElementById('cryptoAmount');

        if (networkEl) networkEl.textContent = methodId === 'btc' ? 'Bitcoin' : 'Litecoin';
        if (addrEl) addrEl.textContent = methodId === 'btc' ? BTC_ADDRESS : LTC_ADDRESS;
        if (amountEl) amountEl.textContent = totalEl.textContent;

        const copyAddrBtn = document.getElementById('copyCryptoAddress');
        const copyAmtBtn = document.getElementById('copyCryptoAmount');
        if (copyAddrBtn) {
          copyAddrBtn.onclick = async () => {
            try { await navigator.clipboard.writeText(addrEl.textContent.trim()); } catch(e) {}
          };
        }
        if (copyAmtBtn) {
          copyAmtBtn.onclick = async () => {
            try { await navigator.clipboard.writeText(amountEl.textContent.trim()); } catch(e) {}
          };
        }

        try {
          await sendOrderToBot();
        } catch(e) {}
        try {
          await sendOrderToDiscord();
        } catch(e) {}

        const follow = document.getElementById('discordFollowup');
        if (follow) follow.style.display = 'block';

        btn.textContent = originalText;
        btn.disabled = false;
        return;
      }

      // Autres méthodes (fallback) : on envoie seulement la commande côté Discord
      try {
        await sendOrderToBot();
      } catch(e) {}
      let ok = await sendOrderToDiscord();

      btn.textContent = ok ? 'Commande envoyée' : originalText;
      if (!ok) {
        btn.disabled = false;
        return;
      }

      if (overlay) {
        overlay.classList.add('active');
      }
    });
  </script>
</body>
</html>
